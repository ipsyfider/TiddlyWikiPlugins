/***
|''Name:''|SlideShowPlugin|
|''Description:''|Creates a slide show from any number of tiddlers|
|''Documentation:''|[[SlideShowPlugin Documentation|SlideShowPluginDoc]]|
|''Author:''|Paulo Soares / fork: [[Tobias Beer|http://tobibeer.github.io]]|
|''Contributors:''|John P. Rouillard|
|''Version:''|2.4.4 (2013-10-08)|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/forked/PauloSoares/SlideShowPlugin.js|
|''Master:''|http://www.math.ist.utl.pt/~psoares/addons.html|
|''License:''|[[Creative Commons Attribution-Share Alike 3.0 License|http://creativecommons.org/licenses/by-sa/3.0/]]|
|''~CoreVersion:''|2.5.0|
This fork introduces the {{{controls}}} parameter that allows to show the controls by default.

Provides mobile touch support: install touchwipe as a plugin...
http://www.netcu.de/jquery-touchwipe-iphone-ipad-library
***/
///%
(function(e){if(!version.extensions.SlideShowPlugin){version.extensions.SlideShowPlugin={installed:true};var t=config.macros.slideShow={maxTOCLength:30,separator:"-s-",text:{label:"slide show",tooltip:"Start the slide show",quit:{label:"x",tooltip:"quit",button:"quit slideshow"},firstSlide:{label:"<<",tooltip:"first slide"},previous:{label:"<",tooltip:"previous slide"},next:{label:">",tooltip:"next slide"},lastSlide:{label:">>",tooltip:"last slide"},"goto":{label:"Go to slide:"},resetClock:{tooltip:"reset clock"},overlay:"overlay"},handler:function(e,n,r,i,s){var o=s.parseParams(null,null,false);createTiddlyButton(e,getParam(o,"label",t.text.label),getParam(o,"tooltip",t.text.tooltip),function(){t.onClick(e,s);return false});return false},onClick:function(n,r){var i,s=0,o=new Date(0),u=story.findContainingTiddler(n),a=r.parseParams(null,null,false),f=r.readMacroParams();u=u?u.getAttribute("tiddler"):null;u=getParam(a,"tiddler",u);t.mobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);t.blocked=0;t.slides=[];t.slideTOC=[];t.openTiddlers=[];t.single=f.contains("single");t.clicks=!f.contains("noClicks");t.keyboard=!f.contains("noKeyboard");t.showAll=f.contains("showAll");t.cycle=f.contains("cycle");t.overlays=!f.contains("noOverlays");t.controls=f.contains("controls");t.theme=getParam(a,"theme");t.tag=getParam(a,"tag");t.toc=getParam(a,"toc","headers");t.sort=getParam(a,"sort");t.clockFormat=getParam(a,"clockFormat","0hh:0mm:0ss");t.auto=getParam(a,"auto",0);t.header=getParam(a,"header",u);t.footer=getParam(a,"footer","");t.clock=getParam(a,"clock");t.clockType=parseFloat(t.clock);if(t.clock){t.clockCorrection=o.getTimezoneOffset()*6e4;o=new Date;t.clockMultiplier=1;t.clockInterval=0;if(t.clockType<0){t.clockMultiplier=-1;t.clockInterval=-t.clockType*6e4}else if(t.clockType==0){t.clockCorrection=0;o=new Date(0)}t.clockStartTime=o.getTime()}e("#tiddlerDisplay > *").each(function(){t.openTiddlers.push(e(this).attr("tiddler"))});if(t.single){if(!store.tiddlerExists(u))return;e.each(store.getTiddlerText(u).split(t.separator),function(){s++;i=new Tiddler;i.title="TempSlide"+s;i.tags[0]="excludeLists";i.text=e.trim(this);i.fields["doNotSave"]=true;store.addTiddler(i);t.buildTOC(s,i.title);t.slides.push(i.title)})}else if(t.tag){e.each(store.getTaggedTiddlers(t.tag,t.sort),function(){s++;t.buildTOC(s,t.title);t.slides.push(t.title)})}else{story.displayTiddler(null,u);e.each(e("[tiddler="+u+"]").find(".viewer").find(".tiddlyLinkExisting"),function(){if(!e(this).parents().hasClass("exclude")){i=e(this).attr("tiddlylink");s++;t.buildTOC(s,i);t.slides.push(i)}})}t.nSlides=t.slides.length;if(t.nSlides==0)return false;clearMessage();t.toggleSlideStyles();if(!t.showAll){if(t.keyboard&&!e("#tiddlerDisplay").hasClass("noKeyboard"))e(document).keyup(t.keys);if(t.clicks){e(document).mouseup(t.clicker);document.oncontextmenu=function(){return false}}if(t.clock)t.slideClock=setInterval(t.setClock,1e3);if(t.auto>0){t.autoAdvance=setInterval(t.next,t.auto*1e3)}t.showSlide(1)}else{story.closeAllTiddlers();story.displayTiddlers(null,t.slides);e(document).keyup(t.endSlideShow)}return false},buildNavigator:function(){var n,r,i,s,o=e("#controlBar")[0];if(!o)return;e(o).addClass("slideFooterOff noClicks");i=createTiddlyElement(o,"SPAN","navigator");n=createTiddlyElement(i,"SPAN","buttonBar");if(t.controls)e(o).removeClass("slideFooterOff").show();else e(o).bind("mouseenter mouseleave",function(t){e(this).toggleClass("slideFooterOff")});["firstSlide","previous","quit|endSlideShow","next","lastSlide"].map(function(e){e=e.split("|");var r=e[1]?e[1]:e[0],e=e[0];createTiddlyButton(n,t.text[e].label,t.text[e].tooltip,t[r],"button "+e)});if(t.clock){if(t.clock==0){createTiddlyElement(i,"SPAN","slideClock")}else{createTiddlyButton(i," ",t.text.resetClock.tooltip,t.resetClock,"button","slideClock")}t.setClock()}createTiddlyElement(o,"SPAN","slideCounter").onclick=t.toggleTOC;s=createTiddlyElement(createTiddlyElement(document.body,"div","toc",t.mobile?" mobile":""),"div");if(t.mobile)createTiddlyButton(s,t.text.quit.button,"",t.endSlideShow,"button quit");for(r=0;r<t.slideTOC.length;r++){e(s).append(t.slideTOC[r][2]);e(s.lastChild).addClass("tocLevel"+t.slideTOC[r][1]).css("cursor","pointer").hover(function(){e(this).addClass("highlight")},function(){e(this).removeClass("highlight")}).attr("slide",t.slideTOC[r][0]).click(t.showSlideFromTOC)}e(createTiddlyElement(createTiddlyElement(s,"DIV","jumpItem",null,t.text.goto.label),"INPUT","jumpInput",null,null,null,{type:"text"})).keyup(t.jumpToSlide);t.wipe("#slideHeader, #slideFooter, #controlBar")},abbreviate:function(e){var n,r=new Array;if(e.length>t.maxTOCLength){r=e.split(" ");e=r[0];for(n=1;n<r.length;n++){if(e.length+r[n].length<=t.maxTOCLength){e+=" "+r[n]}else{e+=" ...";break}}}return e},buildTOC:function(e,n){var r,i=1,s,o,u;switch(t.toc){case"titles":t.slideTOC.push([e,i,"<div>"+t.abbreviate(n)+"</div>"]);break;case"headers":r=wikifyStatic(store.getTiddlerText(n));u=r.replace(/<div class="comment">.*<\/div>/mg,"");o=u.match(/<h[123456]>.*?<\/h[123456]>/mgi);if(o){for(s=0;s<o.length;s++){i=o[s].charAt(2);u=o[s].replace(/<\/?h[123456]>/gi,"");u=t.abbreviate(u);t.slideTOC.push([e,i,"<div>"+u+"</div>"])}}}},showSlideFromTOC:function(n){var r=parseInt(n.target.getAttribute("slide"));e("#toc").hide();t.showSlide(r);return false},toggleTOC:function(){var t=e("#jumpInput");e("#toc").toggle();t.val("");if(!t.closest(".mobile").length)t.focus();return false},jumpToSlide:function(n){if(n.which==13){var r=parseInt(e("#jumpInput").val());if(!isNaN(r)){r=Math.min(r,t.nSlides);e("#toc").hide();t.showSlide(Math.max(r,1))}else{e("#jumpInput").val("")}}return false},toggleSlideStyles:function(){var n=e("#contentWrapper");if(n.hasClass("slideShowMode")){refreshPageTemplate();removeStyleSheet("SlideShowStyleSheet");if(t.theme)removeStyleSheet(t.theme)}else{e("#displayArea").prepend('<div id="slideBlanker" style="display:none"></div>'+'<div id="slideHeader">'+t.header+"</div>"+'<div id="slideFooter">'+t.footer+"</div>"+'<div id="controlBar"></div>');setStylesheet(store.getRecursiveTiddlerText("SlideShowStyleSheet"),"SlideShowStyleSheet");if(t.theme&&store.tiddlerExists(t.theme)){setStylesheet(store.getRecursiveTiddlerText(t.theme),t.theme)}t.buildNavigator()}n.toggleClass("slideShowMode");return false},showSlide:function(n){var r,i;if(t.cycle){if(n>t.nSlides){n=1}else if(n<1){n=t.nSlides}}else{if(n>t.nSlides||n<1)return}story.closeAllTiddlers();if(t.clock=="-"){t.resetClock()}r=story.displayTiddler(null,String(t.slides[n-1]));if(!r)r=story.getTiddler(t.slides[n-1]);r.setAttribute("ondblclick",null);t.wipe(".tiddler");e("body").removeClass("slide"+t.curSlide);t.curSlide=n;e("body").addClass("slide slide"+t.curSlide);e("#slideCounter").text(t.curSlide+"/"+t.nSlides);if(t.overlays){var i=e(".viewer *");t.numOverlays=1;while(1){if(i.hasClass(t.text.overlay+t.numOverlays)){t.numOverlays++}else{break}}t.numOverlays--;t.showOverlay(0)}return false},showOverlay:function(n){var r,i;if(!t.overlays||t.numOverlays==0||n<0||n>t.numOverlays){return}for(r=1;r<n;r++){i=e(".viewer "+"."+t.text.overlay+r);i.removeClass("currentOverlay nextOverlay");i.addClass("previousOverlay")}i=e(".viewer "+"."+t.text.overlay+n);i.removeClass("previousOverlay nextOverlay");i.addClass("currentOverlay");for(r=n;r<t.numOverlays;r++){i=e(".viewer "+"."+t.text.overlay+(r+1));i.removeClass("previousOverlay currentOverlay");i.addClass("nextOverlay")}t.curOverlay=n},firstSlide:function(){t.showSlide(1);return false},lastSlide:function(){t.showSlide(t.nSlides);return false},next:function(){if(!t.overlays||t.numOverlays==0||t.curOverlay==t.numOverlays){t.showSlide(t.curSlide+1)}else{t.showOverlay(t.curOverlay+1)}return false},previous:function(){if(!t.overlays||t.numOverlays==0||t.curOverlay==0){t.showSlide(t.curSlide-1);t.showOverlay(t.numOverlays)}else{t.showOverlay(t.curOverlay-1)}return false},endSlideShow:function(){if(t.autoAdvance){clearInterval(t.autoAdvance)}if(t.clock)clearInterval(t.slideClock);e("#toc").remove();story.closeAllTiddlers();t.toggleSlideStyles();story.displayTiddlers(null,t.openTiddlers);e("body").removeClass("slide slide"+t.curSlide);document.oncontextmenu=function(){};e(document).unbind();return false},keys:function(n){if(n.which==27){t.endSlideShow()}else if(n.which==66){e("#slideBlanker").toggle();t.blocked=(t.blocked+1)%2}else if(0==t.blocked){switch(n.which){case 32:if(t.auto>0){if(t.autoAdvance){clearInterval(t.autoAdvance);t.autoAdvance=null}else{t.autoAdvance=setInterval(t.next,t.auto*1e3)}}else{t.next()}break;case 33:t.showSlide(t.curSlide-1);break;case 34:t.showSlide(t.curSlide+1);break;case 35:t.lastSlide();break;case 36:t.firstSlide();break;case 37:t.previous();break;case 38:t.showOverlay(0);break;case 39:t.next();break;case 40:t.showOverlay(t.numOverlays);break}}return false},clicker:function(n){if(t.blocked==1||e(n.target).attr("href")||e(n.target).is("input")||e(n.target).parents().andSelf().hasClass("noClicks"))return true;if(e("#toc").is(":visible")){t.toggleTOC()}else{if(!n.which&&n.button==1||n.which==1){t.next()}if(!n.which&&n.button==2||n.which==3){t.previous()}}return false},setClock:function(){var n=new Date,r=n.getTime()-t.clockStartTime;r=t.clockMultiplier*r+t.clockInterval+t.clockCorrection;n.setTime(r);r=n.formatString(t.clockFormat);e("#slideClock").text(r);return false},resetClock:function(){var e,n;if(t.clock==0)return;e=new Date(0);if(t.clockStartTime>e){n=new Date;t.clockStartTime=n.getTime()}return false},wipe:function(n){if(e.fn.touchwipe){e(n).touchwipe({wipeLeft:t.next,wipeRight:t.previous,wipeUp:t.firstSlide,wipeDown:t.lastSlide})}}};config.formatters.push({name:"SlideSeparator",match:"^"+t.separator+"+$\\n?",handler:function(e){createTiddlyElement(e.output,"hr",null,"slideSeparator")}});config.shadowTiddlers.SlideShowStyleSheet=["/*{{{*/",".header, #mainMenu, #sidebar,","#backstageButton, #backstageArea,",".toolbar, .title, .subtitle,",".tagging, .tagged, .tagClear, .comment{"," display:none !important","}\n","#slideBlanker{"," position: absolute;"," top: 0;"," left: 0;"," width: 100%;"," height: 100%;"," z-index: 90;"," background-color: #000;"," opacity: 0.9;"," filter: alpha(opacity=90)","}\n",".nextOverlay{"," visibility: hidden","}\n",".previousOverlay,.currentOverlay{"," visibility: visible","}\n","#displayArea{"," font-size: 250%;"," margin: 0 !important;"," padding: 0","}\n","#controlBar{"," position: fixed;"," bottom: 2px;"," right: 0.5em;"," width: 100%;"," text-align: right","}\n","#controlBar .button{"," margin: 0 0.25em;"," padding: 0 0.25em","}\n","","#slideHeader{"," font-size: 200%;"," font-weight: bold","}\n","#slideFooter{"," position: fixed;"," bottom: 2px","}\n",".slideFooterOff #navigator{"," visibility: hidden","}\n","#slideClock{"," margin: 0 5px 0 5px","}\n","#slideCounter{"," cursor: pointer;"," color: #aaa","}\n","#toc{"," display: none;"," position: fixed;"," top: 1em;"," bottom: 3em;"," right: 0.5em;"," font-size: 2em;"," text-align: left;","}\n","#toc > div {"," position:absolute;"," right:0;"," bottom:0;"," padding: 5px;"," overflow: auto;"," max-height: 95%;"," min-width: 300px;"," background: [[ColorPalette::Background]];"," border: 1px solid [[ColorPalette::TertiaryMid]];","}\n","#toc .quit{"," display:block;"," margin-bottom:7px;","}\n","#toc.mobile{"," font-size: 4em;","}\n","#jumpItem{"," padding-left:0.25em;"," margin-top:7px;","}\n","#jumpInput{"," margin-left: 0.25em;"," width: 3em","}\n",".tocLevel1{"," font-size: .8em","}\n",".tocLevel2{"," margin-left: 1em;"," font-size: .75em","}\n",".tocLevel3{"," margin-left: 2em;"," font-size: .7em","}\n",".tocLevel4{"," margin-left: 3em;"," font-size: .65em","}\n",".tocLevel5{"," margin-left: 4em;"," font-size: .6em","}\n",".tocLevel6{"," margin-left: 5em;"," font-size: .55em","}\n",".slide .tiddler{"," height:100%;","}\n","/*}}}*/"].join("\n");config.shadowTiddlers.SlideShowPluginDoc="[[SlideShowPlugin Documentation|http://www.math.ist.utl.pt/~psoares/addons.html#SlideShowPluginDoc]]"}})(jQuery)
//%/